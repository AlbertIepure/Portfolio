<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T2U3">Fcoarseness</span> = coarseness (<span class="var type1" id="S3T1U6">I</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="mxinfo " id="T2:U3"><span class="var type1" id="S4T2U9">t</span> = <span class="mxinfo " id="T2:U5">0.9</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="mxinfo " id="T2:U6"><span class="var type1" id="S5T2U13">k_max</span> = <span class="mxinfo " id="T2:U8">6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="mxinfo " id="T2:U9">[<span class="var type1" id="S6T2U18">height</span>,<span class="var type1" id="S7T2U19">width</span>] = size(<span class="var type1" id="S3T1U22">I</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="mxinfo " id="T24:U13"><span class="var type1" id="S9T24U25">A</span> = <span class="mxinfo " id="T24:U15">zeros(<span class="var type1" id="S6T2U28">height</span>,<span class="var type1" id="S7T2U29">width</span>,<span class="mxinfo " id="T2:U18"><span class="var type1" id="S5T2U30">k_max</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="mxinfo " id="T24:U20"><span class="var type1" id="S11T24U33">E_h</span> = <span class="mxinfo " id="T24:U22">zeros(<span class="var type1" id="S6T2U36">height</span>,<span class="var type1" id="S7T2U37">width</span>,<span class="mxinfo " id="T2:U25"><span class="var type1" id="S5T2U38">k_max</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="mxinfo " id="T24:U27"><span class="var type1" id="S12T24U41">E_v</span> = <span class="mxinfo " id="T24:U29">zeros(<span class="var type1" id="S6T2U44">height</span>,<span class="var type1" id="S7T2U45">width</span>,<span class="mxinfo " id="T2:U32"><span class="var type1" id="S5T2U46">k_max</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo " id="T24:U34"><span class="var type1" id="S13T24U49">E_dr</span> = <span class="mxinfo " id="T24:U36">zeros(<span class="var type1" id="S6T2U52">height</span>,<span class="var type1" id="S7T2U53">width</span>,<span class="mxinfo " id="T2:U39"><span class="var type1" id="S5T2U54">k_max</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo " id="T24:U41"><span class="var type1" id="S14T24U57">E_dl</span> = <span class="mxinfo " id="T24:U43">zeros(<span class="var type1" id="S6T2U60">height</span>,<span class="var type1" id="S7T2U61">width</span>,<span class="mxinfo " id="T2:U46"><span class="var type1" id="S5T2U62">k_max</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="mxinfo " id="T1:U48"><span class="var type1" id="S15T1U65">S</span> = <span class="mxinfo " id="T1:U50">zeros(<span class="var type1" id="S6T2U68">height</span>,<span class="var type1" id="S7T2U69">width</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S16T2U72">x</span>=<span class="mxinfo " id="T2:U54">1</span>:<span class="var type1" id="S6T2U75">height</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S17T2U78">y</span>=<span class="mxinfo " id="T2:U57">1</span>:<span class="var type1" id="S7T2U81">width</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S18T2U84">k</span>=<span class="mxinfo " id="T2:U60">1</span>:<span class="var type1" id="S5T2U87">k_max</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line">            <span class="comment">%% as in the paper</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line">            <span class="comment">%% Step 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line">            <span class="mxinfo " id="T17:U62"><span class="var type1" id="S19T17U90">y_pos</span> = <span class="mxinfo " id="T17:U64"><span class="mxinfo " id="T2:U65"><span class="var type1" id="S17T2U93">y</span> - <span class="mxinfo " id="T2:U67"><span class="mxinfo " id="T2:U68">2</span>^(<span class="mxinfo " id="T2:U69"><span class="var type1" id="S18T2U98">k</span>-<span class="mxinfo " id="T2:U71">1</span></span>)</span></span> :<span class="mxinfo " id="T2:U72"><span class="mxinfo " id="T2:U73"><span class="var type1" id="S17T2U102">y</span> + <span class="mxinfo " id="T2:U75"><span class="mxinfo " id="T2:U76">2</span>^(<span class="mxinfo " id="T2:U77"><span class="var type1" id="S18T2U107">k</span>-<span class="mxinfo " id="T2:U79">1</span></span>)</span></span> - <span class="mxinfo " id="T2:U80">1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line">            <span class="mxinfo " id="T17:U81"><span class="var type1" id="S19T17U112">y_pos</span> = <span class="mxinfo " id="T17:U83"><span class="var type1" id="S19T17U114">y_pos</span>(<span class="mxinfo " id="T29:U85"><span class="mxinfo " id="T29:U86"><span class="var type1" id="S19T17U117">y_pos</span>&gt;<span class="mxinfo " id="T2:U88">0</span></span> &amp; <span class="mxinfo " id="T29:U89"><span class="var type1" id="S19T17U120">y_pos</span>&lt;<span class="var type1" id="S7T2U121">width</span></span></span>)</span></span>; <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line">            <span class="mxinfo " id="T17:U92"><span class="var type1" id="S20T17U124">x_pos</span> = <span class="mxinfo " id="T17:U94"><span class="mxinfo " id="T2:U95"><span class="var type1" id="S16T2U127">x</span> - <span class="mxinfo " id="T2:U97"><span class="mxinfo " id="T2:U98">2</span>^(<span class="mxinfo " id="T2:U99"><span class="var type1" id="S18T2U132">k</span>-<span class="mxinfo " id="T2:U101">1</span></span>)</span></span> :<span class="mxinfo " id="T2:U102"><span class="mxinfo " id="T2:U103"><span class="var type1" id="S16T2U136">x</span> + <span class="mxinfo " id="T2:U105"><span class="mxinfo " id="T2:U106">2</span>^(<span class="mxinfo " id="T2:U107"><span class="var type1" id="S18T2U141">k</span>-<span class="mxinfo " id="T2:U109">1</span></span>)</span></span> - <span class="mxinfo " id="T2:U110">1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line">            <span class="mxinfo " id="T17:U111"><span class="var type1" id="S20T17U146">x_pos</span> = <span class="mxinfo " id="T17:U113"><span class="var type1" id="S20T17U148">x_pos</span>(<span class="mxinfo " id="T29:U115"><span class="mxinfo " id="T29:U116"><span class="var type1" id="S20T17U151">x_pos</span>&gt;<span class="mxinfo " id="T2:U118">0</span></span> &amp; <span class="mxinfo " id="T29:U119"><span class="var type1" id="S20T17U154">x_pos</span>&lt;<span class="var type1" id="S6T2U155">height</span></span></span>)</span></span>; <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line">            <span class="comment">%% Q: What happens at the boundaries?</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line">            <span class="mxinfo " id="T1:U122"><span class="var type1" id="S21T1U158">range</span> = <span class="mxinfo " id="T1:U124"><span class="var type1" id="S3T1U160">I</span>(<span class="var type1" id="S20T17U161">x_pos</span>,<span class="var type1" id="S19T17U162">y_pos</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line">            <span class="mxinfo " id="T2:U128"><span class="mxinfo " id="T2:U129"><span class="var type1" id="S9T24U166">A</span>(<span class="var type1" id="S16T2U167">x</span>,<span class="var type1" id="S17T2U168">y</span>,<span class="var type1" id="S18T2U169">k</span>)</span> = <span class="mxinfo " id="T2:U134"><span class="mxinfo " id="T2:U135">sum(<span class="mxinfo " id="T18:U136"><span class="var type1" id="S21T1U174">range</span>(:)</span>)</span>/<span class="mxinfo " id="T2:U138"><span class="mxinfo " id="T2:U139">2</span>.^(<span class="mxinfo " id="T2:U140"><span class="mxinfo " id="T2:U141">2</span>*<span class="var type1" id="S18T2U181">k</span></span>)</span></span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%% Step 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S16T2U184">x</span>=<span class="mxinfo " id="T2:U144">1</span>:<span class="var type1" id="S6T2U187">height</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S17T2U190">y</span>=<span class="mxinfo " id="T2:U147">1</span>:<span class="var type1" id="S7T2U193">width</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S18T2U196">k</span>=<span class="mxinfo " id="T2:U150">1</span>:<span class="var type1" id="S5T2U199">k_max</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line">            <span class="comment">%% Q: What happens at the boundaries?</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U152"><span class="mxinfo " id="T2:U153"><span class="var type1" id="S16T2U204">x</span>+<span class="mxinfo " id="T2:U155"><span class="mxinfo " id="T2:U156">2</span>^(<span class="mxinfo " id="T2:U157"><span class="var type1" id="S18T2U209">k</span>-<span class="mxinfo " id="T2:U159">1</span></span>)</span></span> &lt;= <span class="var type1" id="S6T2U211">height</span></span> <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line">                <span class="mxinfo " id="T2:U161"><span class="var type1" id="S23T2U214">term_1</span> = <span class="mxinfo " id="T2:U163"><span class="var type1" id="S9T24U216">A</span>(<span class="mxinfo " id="T2:U165"><span class="var type1" id="S16T2U218">x</span>+<span class="mxinfo " id="T2:U167"><span class="mxinfo " id="T2:U168">2</span>.^(<span class="mxinfo " id="T2:U169"><span class="var type1" id="S18T2U223">k</span>-<span class="mxinfo " id="T2:U171">1</span></span>)</span></span>,<span class="var type1" id="S17T2U225">y</span>,<span class="var type1" id="S18T2U226">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">                <span class="mxinfo " id="T2:U174"><span class="var type1" id="S23T2U230">term_1</span> = <span class="mxinfo " id="T2:U176">0</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U177"><span class="mxinfo " id="T2:U178"><span class="var type1" id="S16T2U236">x</span>-<span class="mxinfo " id="T2:U180"><span class="mxinfo " id="T2:U181">2</span>^(<span class="mxinfo " id="T2:U182"><span class="var type1" id="S18T2U241">k</span>-<span class="mxinfo " id="T2:U184">1</span></span>)</span></span> &gt;= <span class="mxinfo " id="T2:U185">1</span></span> <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">                <span class="mxinfo " id="T2:U186"><span class="var type1" id="S24T2U246">term_2</span> = <span class="mxinfo " id="T2:U188"><span class="var type1" id="S9T24U248">A</span>(<span class="mxinfo " id="T2:U190"><span class="var type1" id="S16T2U250">x</span>-<span class="mxinfo " id="T2:U192"><span class="mxinfo " id="T2:U193">2</span>.^(<span class="mxinfo " id="T2:U194"><span class="var type1" id="S18T2U255">k</span>-<span class="mxinfo " id="T2:U196">1</span></span>)</span></span>,<span class="var type1" id="S17T2U257">y</span>,<span class="var type1" id="S18T2U258">k</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">                <span class="mxinfo " id="T2:U199"><span class="var type1" id="S24T2U262">term_2</span> = <span class="mxinfo " id="T2:U201">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">            <span class="mxinfo " id="T2:U202"><span class="mxinfo " id="T2:U203"><span class="var type1" id="S11T24U267">E_h</span>(<span class="var type1" id="S16T2U268">x</span>,<span class="var type1" id="S17T2U269">y</span>,<span class="var type1" id="S18T2U270">k</span>)</span> = <span class="mxinfo " id="T2:U208">abs(<span class="mxinfo " id="T2:U209"><span class="var type1" id="S23T2U274">term_1</span> - <span class="var type1" id="S24T2U275">term_2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U212"><span class="mxinfo " id="T2:U213"><span class="var type1" id="S17T2U280">y</span>+<span class="mxinfo " id="T2:U215"><span class="mxinfo " id="T2:U216">2</span>^(<span class="mxinfo " id="T2:U217"><span class="var type1" id="S18T2U285">k</span>-<span class="mxinfo " id="T2:U219">1</span></span>)</span></span> &lt;= <span class="var type1" id="S7T2U287">width</span></span> <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">                <span class="mxinfo " id="T2:U221"><span class="var type1" id="S23T2U290">term_1</span> = <span class="mxinfo " id="T2:U223"><span class="var type1" id="S9T24U292">A</span>(<span class="var type1" id="S16T2U293">x</span>,<span class="mxinfo " id="T2:U226"><span class="var type1" id="S17T2U295">y</span>+<span class="mxinfo " id="T2:U228"><span class="mxinfo " id="T2:U229">2</span>.^(<span class="mxinfo " id="T2:U230"><span class="var type1" id="S18T2U300">k</span>-<span class="mxinfo " id="T2:U232">1</span></span>)</span></span>,<span class="var type1" id="S18T2U302">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">                <span class="mxinfo " id="T2:U234"><span class="var type1" id="S23T2U306">term_1</span> = <span class="mxinfo " id="T2:U236">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U237"><span class="mxinfo " id="T2:U238"><span class="var type1" id="S17T2U312">y</span>-<span class="mxinfo " id="T2:U240"><span class="mxinfo " id="T2:U241">2</span>^(<span class="mxinfo " id="T2:U242"><span class="var type1" id="S18T2U317">k</span>-<span class="mxinfo " id="T2:U244">1</span></span>)</span></span> &gt;= <span class="mxinfo " id="T2:U245">1</span></span> <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">                <span class="mxinfo " id="T2:U246"><span class="var type1" id="S24T2U322">term_2</span> = <span class="mxinfo " id="T2:U248"><span class="var type1" id="S9T24U324">A</span>(<span class="var type1" id="S16T2U325">x</span>,<span class="mxinfo " id="T2:U251"><span class="var type1" id="S17T2U327">y</span>-<span class="mxinfo " id="T2:U253"><span class="mxinfo " id="T2:U254">2</span>.^(<span class="mxinfo " id="T2:U255"><span class="var type1" id="S18T2U332">k</span>-<span class="mxinfo " id="T2:U257">1</span></span>)</span></span>,<span class="var type1" id="S18T2U334">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">                <span class="mxinfo " id="T2:U259"><span class="var type1" id="S24T2U338">term_2</span> = <span class="mxinfo " id="T2:U261">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">            <span class="mxinfo " id="T2:U262"><span class="mxinfo " id="T2:U263"><span class="var type1" id="S12T24U343">E_v</span>(<span class="var type1" id="S16T2U344">x</span>,<span class="var type1" id="S17T2U345">y</span>,<span class="var type1" id="S18T2U346">k</span>)</span> = <span class="mxinfo " id="T2:U268">abs(<span class="mxinfo " id="T2:U269"><span class="var type1" id="S23T2U350">term_1</span> - <span class="var type1" id="S24T2U351">term_2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U272"><span class="mxinfo " id="T2:U273"><span class="var type1" id="S16T2U357">x</span>+<span class="mxinfo " id="T2:U275"><span class="mxinfo " id="T2:U276">2</span>^(<span class="mxinfo " id="T2:U277"><span class="var type1" id="S18T2U362">k</span>-<span class="mxinfo " id="T2:U279">1</span></span>)</span></span> &lt;= <span class="var type1" id="S6T2U364">height</span></span> &amp;&amp; <span class="mxinfo " id="T3:U281"><span class="mxinfo " id="T2:U282"><span class="var type1" id="S17T2U367">y</span>+<span class="mxinfo " id="T2:U284"><span class="mxinfo " id="T2:U285">2</span>^(<span class="mxinfo " id="T2:U286"><span class="var type1" id="S18T2U372">k</span>-<span class="mxinfo " id="T2:U288">1</span></span>)</span></span> &lt;= <span class="var type1" id="S7T2U374">width</span></span><span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">                <span class="mxinfo " id="T2:U290"><span class="var type1" id="S23T2U377">term_1</span> = <span class="mxinfo " id="T2:U292"><span class="var type1" id="S9T24U379">A</span>(<span class="mxinfo " id="T2:U294"><span class="var type1" id="S16T2U381">x</span>+<span class="mxinfo " id="T2:U296"><span class="mxinfo " id="T2:U297">2</span>.^(<span class="mxinfo " id="T2:U298"><span class="var type1" id="S18T2U386">k</span>-<span class="mxinfo " id="T2:U300">1</span></span>)</span></span>,<span class="mxinfo " id="T2:U301"><span class="var type1" id="S17T2U389">y</span>+<span class="mxinfo " id="T2:U303"><span class="mxinfo " id="T2:U304">2</span>^(<span class="mxinfo " id="T2:U305"><span class="var type1" id="S18T2U394">k</span>-<span class="mxinfo " id="T2:U307">1</span></span>)</span></span>,<span class="var type1" id="S18T2U396">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">                <span class="mxinfo " id="T2:U309"><span class="var type1" id="S23T2U400">term_1</span> = <span class="mxinfo " id="T2:U311">0</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U312"><span class="mxinfo " id="T2:U313"><span class="var type1" id="S16T2U407">x</span>-<span class="mxinfo " id="T2:U315"><span class="mxinfo " id="T2:U316">2</span>^(<span class="mxinfo " id="T2:U317"><span class="var type1" id="S18T2U412">k</span>-<span class="mxinfo " id="T2:U319">1</span></span>)</span></span> &gt;= <span class="mxinfo " id="T2:U320">1</span></span> &amp;&amp; <span class="mxinfo " id="T3:U321"><span class="mxinfo " id="T2:U322"><span class="var type1" id="S17T2U417">y</span>-<span class="mxinfo " id="T2:U324"><span class="mxinfo " id="T2:U325">2</span>^(<span class="mxinfo " id="T2:U326"><span class="var type1" id="S18T2U422">k</span>-<span class="mxinfo " id="T2:U328">1</span></span>)</span></span> &gt;= <span class="mxinfo " id="T2:U329">1</span></span> <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">                <span class="mxinfo " id="T2:U330"><span class="var type1" id="S24T2U427">term_2</span> = <span class="mxinfo " id="T2:U332"><span class="var type1" id="S9T24U429">A</span>(<span class="mxinfo " id="T2:U334"><span class="var type1" id="S16T2U431">x</span>-<span class="mxinfo " id="T2:U336"><span class="mxinfo " id="T2:U337">2</span>.^(<span class="mxinfo " id="T2:U338"><span class="var type1" id="S18T2U436">k</span>-<span class="mxinfo " id="T2:U340">1</span></span>)</span></span>,<span class="mxinfo " id="T2:U341"><span class="var type1" id="S17T2U439">y</span>-<span class="mxinfo " id="T2:U343"><span class="mxinfo " id="T2:U344">2</span>^(<span class="mxinfo " id="T2:U345"><span class="var type1" id="S18T2U444">k</span>-<span class="mxinfo " id="T2:U347">1</span></span>)</span></span>,<span class="var type1" id="S18T2U446">k</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">                <span class="mxinfo " id="T2:U349"><span class="var type1" id="S24T2U450">term_2</span> = <span class="mxinfo " id="T2:U351">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">            <span class="mxinfo " id="T2:U352"><span class="mxinfo " id="T2:U353"><span class="var type1" id="S13T24U455">E_dr</span>(<span class="var type1" id="S16T2U456">x</span>,<span class="var type1" id="S17T2U457">y</span>,<span class="var type1" id="S18T2U458">k</span>)</span> = <span class="mxinfo " id="T2:U358">abs(<span class="mxinfo " id="T2:U359"><span class="var type1" id="S23T2U462">term_1</span> - <span class="var type1" id="S24T2U463">term_2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U362"><span class="mxinfo " id="T2:U363"><span class="var type1" id="S16T2U469">x</span>+<span class="mxinfo " id="T2:U365"><span class="mxinfo " id="T2:U366">2</span>^(<span class="mxinfo " id="T2:U367"><span class="var type1" id="S18T2U474">k</span>-<span class="mxinfo " id="T2:U369">1</span></span>)</span></span> &lt;= <span class="var type1" id="S6T2U476">height</span></span> &amp;&amp; <span class="mxinfo " id="T3:U371"><span class="mxinfo " id="T2:U372"><span class="var type1" id="S17T2U479">y</span>-<span class="mxinfo " id="T2:U374"><span class="mxinfo " id="T2:U375">2</span>^(<span class="mxinfo " id="T2:U376"><span class="var type1" id="S18T2U484">k</span>-<span class="mxinfo " id="T2:U378">1</span></span>)</span></span> &gt;= <span class="mxinfo " id="T2:U379">1</span></span> <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">                <span class="mxinfo " id="T2:U380"><span class="var type1" id="S23T2U489">term_1</span> = <span class="mxinfo " id="T2:U382"><span class="var type1" id="S9T24U491">A</span>(<span class="mxinfo " id="T2:U384"><span class="var type1" id="S16T2U493">x</span>+<span class="mxinfo " id="T2:U386"><span class="mxinfo " id="T2:U387">2</span>.^(<span class="mxinfo " id="T2:U388"><span class="var type1" id="S18T2U498">k</span>-<span class="mxinfo " id="T2:U390">1</span></span>)</span></span>,<span class="mxinfo " id="T2:U391"><span class="var type1" id="S17T2U501">y</span>-<span class="mxinfo " id="T2:U393"><span class="mxinfo " id="T2:U394">2</span>^(<span class="mxinfo " id="T2:U395"><span class="var type1" id="S18T2U506">k</span>-<span class="mxinfo " id="T2:U397">1</span></span>)</span></span>,<span class="var type1" id="S18T2U508">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">                <span class="mxinfo " id="T2:U399"><span class="var type1" id="S23T2U512">term_1</span> = <span class="mxinfo " id="T2:U401">0</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U402"><span class="mxinfo " id="T2:U403"><span class="var type1" id="S16T2U519">x</span>-<span class="mxinfo " id="T2:U405"><span class="mxinfo " id="T2:U406">2</span>^(<span class="mxinfo " id="T2:U407"><span class="var type1" id="S18T2U524">k</span>-<span class="mxinfo " id="T2:U409">1</span></span>)</span></span> &gt;= <span class="mxinfo " id="T2:U410">1</span></span> &amp;&amp; <span class="mxinfo " id="T3:U411"><span class="mxinfo " id="T2:U412"><span class="var type1" id="S17T2U529">y</span>+<span class="mxinfo " id="T2:U414"><span class="mxinfo " id="T2:U415">2</span>^(<span class="mxinfo " id="T2:U416"><span class="var type1" id="S18T2U534">k</span>-<span class="mxinfo " id="T2:U418">1</span></span>)</span></span> &lt;= <span class="var type1" id="S7T2U536">width</span></span> <span class="comment">% make sure it's not out of bounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">                <span class="mxinfo " id="T2:U420"><span class="var type1" id="S24T2U539">term_2</span> = <span class="mxinfo " id="T2:U422"><span class="var type1" id="S9T24U541">A</span>(<span class="mxinfo " id="T2:U424"><span class="var type1" id="S16T2U543">x</span>-<span class="mxinfo " id="T2:U426"><span class="mxinfo " id="T2:U427">2</span>.^(<span class="mxinfo " id="T2:U428"><span class="var type1" id="S18T2U548">k</span>-<span class="mxinfo " id="T2:U430">1</span></span>)</span></span>,<span class="mxinfo " id="T2:U431"><span class="var type1" id="S17T2U551">y</span>+<span class="mxinfo " id="T2:U433"><span class="mxinfo " id="T2:U434">2</span>^(<span class="mxinfo " id="T2:U435"><span class="var type1" id="S18T2U556">k</span>-<span class="mxinfo " id="T2:U437">1</span></span>)</span></span>,<span class="var type1" id="S18T2U558">k</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">                <span class="mxinfo " id="T2:U439"><span class="var type1" id="S24T2U562">term_2</span> = <span class="mxinfo " id="T2:U441">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">            <span class="mxinfo " id="T2:U442"><span class="mxinfo " id="T2:U443"><span class="var type1" id="S14T24U567">E_dl</span>(<span class="var type1" id="S16T2U568">x</span>,<span class="var type1" id="S17T2U569">y</span>,<span class="var type1" id="S18T2U570">k</span>)</span> = <span class="mxinfo " id="T2:U448">abs(<span class="mxinfo " id="T2:U449"><span class="var type1" id="S23T2U574">term_1</span> - <span class="var type1" id="S24T2U575">term_2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%% Step 3</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">% for x=1:height</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%     for y=1:width</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%           % should we make sure that the max is unique!? </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="comment">%         [max_h,k_h] = max(E_h(x,y,:));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="comment">%         [max_v,k_v] = max(E_v(x,y,:));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"><span class="comment">%         if max_h &gt; max_v</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">%             S(x,y) = 2.^k_h;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">%         else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="comment">%             S(x,y) = 2.^k_v;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S16T2U578">x</span>=<span class="mxinfo " id="T2:U453">1</span>:<span class="var type1" id="S6T2U581">height</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S17T2U584">y</span>=<span class="mxinfo " id="T2:U456">1</span>:<span class="var type1" id="S7T2U587">width</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">        <span class="comment">% should we make sure that the max is unique!? </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">        [<span class="mxinfo " id="T2:U458"><span class="var type1" id="S26T2U591">max_h1</span></span>,<span class="mxinfo " id="T2:U460"><span class="var type1" id="S27T2U592">k_h1</span></span>] = max(<span class="mxinfo " id="T25:U462"><span class="var type1" id="S11T24U596">E_h</span>(<span class="var type1" id="S16T2U597">x</span>,<span class="var type1" id="S17T2U598">y</span>,<span class="mxinfo " id="T30:U466">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">        [<span class="mxinfo " id="T2:U467"><span class="var type1" id="S29T2U603">max_v1</span></span>,<span class="mxinfo " id="T2:U469"><span class="var type1" id="S30T2U604">k_v1</span></span>] = max(<span class="mxinfo " id="T25:U471"><span class="var type1" id="S12T24U608">E_v</span>(<span class="var type1" id="S16T2U609">x</span>,<span class="var type1" id="S17T2U610">y</span>,<span class="mxinfo " id="T30:U475">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">        [<span class="mxinfo " id="T2:U476"><span class="var type1" id="S31T2U615">max_dr</span></span>,<span class="mxinfo " id="T2:U478"><span class="var type1" id="S32T2U616">k_dr</span></span>] = max(<span class="mxinfo " id="T25:U480"><span class="var type1" id="S13T24U620">E_dr</span>(<span class="var type1" id="S16T2U621">x</span>,<span class="var type1" id="S17T2U622">y</span>,<span class="mxinfo " id="T30:U484">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">        [<span class="mxinfo " id="T2:U485"><span class="var type1" id="S33T2U627">max_dl</span></span>,<span class="mxinfo " id="T2:U487"><span class="var type1" id="S34T2U628">k_dl</span></span>] = max(<span class="mxinfo " id="T25:U489"><span class="var type1" id="S14T24U632">E_dl</span>(<span class="var type1" id="S16T2U633">x</span>,<span class="var type1" id="S17T2U634">y</span>,<span class="mxinfo " id="T30:U493">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">        <span class="mxinfo " id="T28:U494"><span class="var type1" id="S35T28U638">max_vect</span> = <span class="mxinfo " id="T28:U496">[<span class="var type1" id="S26T2U641">max_h1</span>,<span class="var type1" id="S29T2U642">max_v1</span>,<span class="var type1" id="S31T2U643">max_dr</span>,<span class="var type1" id="S33T2U644">max_dl</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">        <span class="mxinfo " id="T28:U501"><span class="var type1" id="S36T28U647">k_vect</span> = <span class="mxinfo " id="T28:U503">[<span class="var type1" id="S27T2U650">k_h1</span>,<span class="var type1" id="S30T2U651">k_v1</span>,<span class="var type1" id="S32T2U652">k_dr</span>,<span class="var type1" id="S34T2U653">k_dl</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">        [<span class="mxinfo " id="T2:U508"><span class="var type1" id="S37T2U657">max_t1</span></span>, <span class="mxinfo " id="T2:U510"><span class="var type1" id="S38T2U658">index_t1</span></span>] = max(<span class="var type1" id="S35T28U661">max_vect</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">        <span class="mxinfo " id="T2:U513"><span class="var type1" id="S39T2U664">k_t1</span> = <span class="mxinfo " id="T2:U515"><span class="var type1" id="S36T28U666">k_vect</span>(<span class="var type1" id="S38T2U667">index_t1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">        <span class="mxinfo " id="T2:U518"><span class="mxinfo " id="T2:U519"><span class="var type1" id="S15T1U671">S</span>(<span class="var type1" id="S16T2U672">x</span>,<span class="var type1" id="S17T2U673">y</span>)</span> =<span class="mxinfo " id="T2:U523"><span class="mxinfo " id="T2:U524">2</span>.^<span class="var type1" id="S39T2U676">k_t1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T3:U526"><span class="var type1" id="S38T2U680">index_t1</span> == <span class="mxinfo " id="T2:U528">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">            <span class="mxinfo " id="T2:U529"><span class="mxinfo " id="T2:U530"><span class="var type1" id="S11T24U685">E_h</span>(<span class="var type1" id="S16T2U686">x</span>,<span class="var type1" id="S17T2U687">y</span>,<span class="var type1" id="S39T2U688">k_t1</span>)</span> = <span class="mxinfo " id="T2:U535">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T3:U536"><span class="var type1" id="S38T2U693">index_t1</span> == <span class="mxinfo " id="T2:U538">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">            <span class="mxinfo " id="T2:U539"><span class="mxinfo " id="T2:U540"><span class="var type1" id="S12T24U698">E_v</span>(<span class="var type1" id="S16T2U699">x</span>,<span class="var type1" id="S17T2U700">y</span>,<span class="var type1" id="S39T2U701">k_t1</span>)</span> = <span class="mxinfo " id="T2:U545">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T3:U546"><span class="var type1" id="S38T2U706">index_t1</span> == <span class="mxinfo " id="T2:U548">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">            <span class="mxinfo " id="T2:U549"><span class="mxinfo " id="T2:U550"><span class="var type1" id="S13T24U711">E_dr</span>(<span class="var type1" id="S16T2U712">x</span>,<span class="var type1" id="S17T2U713">y</span>,<span class="var type1" id="S39T2U714">k_t1</span>)</span> = <span class="mxinfo " id="T2:U555">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T3:U556"><span class="var type1" id="S38T2U719">index_t1</span> == <span class="mxinfo " id="T2:U558">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">            <span class="mxinfo " id="T2:U559"><span class="mxinfo " id="T2:U560"><span class="var type1" id="S14T24U724">E_dl</span>(<span class="var type1" id="S16T2U725">x</span>,<span class="var type1" id="S17T2U726">y</span>,<span class="var type1" id="S39T2U727">k_t1</span>)</span> = <span class="mxinfo " id="T2:U565">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">        [<span class="mxinfo " id="T2:U566"><span class="var type1" id="S26T2U733">max_h1</span></span>,<span class="mxinfo " id="T2:U568"><span class="var type1" id="S27T2U734">k_h1</span></span>] = max(<span class="mxinfo " id="T25:U570"><span class="var type1" id="S11T24U738">E_h</span>(<span class="var type1" id="S16T2U739">x</span>,<span class="var type1" id="S17T2U740">y</span>,<span class="mxinfo " id="T30:U574">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">        [<span class="mxinfo " id="T2:U575"><span class="var type1" id="S29T2U745">max_v1</span></span>,<span class="mxinfo " id="T2:U577"><span class="var type1" id="S30T2U746">k_v1</span></span>] = max(<span class="mxinfo " id="T25:U579"><span class="var type1" id="S12T24U750">E_v</span>(<span class="var type1" id="S16T2U751">x</span>,<span class="var type1" id="S17T2U752">y</span>,<span class="mxinfo " id="T30:U583">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">        [<span class="mxinfo " id="T2:U584"><span class="var type1" id="S31T2U757">max_dr</span></span>,<span class="mxinfo " id="T2:U586"><span class="var type1" id="S32T2U758">k_dr</span></span>] = max(<span class="mxinfo " id="T25:U588"><span class="var type1" id="S13T24U762">E_dr</span>(<span class="var type1" id="S16T2U763">x</span>,<span class="var type1" id="S17T2U764">y</span>,<span class="mxinfo " id="T30:U592">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">        [<span class="mxinfo " id="T2:U593"><span class="var type1" id="S33T2U769">max_dl</span></span>,<span class="mxinfo " id="T2:U595"><span class="var type1" id="S34T2U770">k_dl</span></span>] = max(<span class="mxinfo " id="T25:U597"><span class="var type1" id="S14T24U774">E_dl</span>(<span class="var type1" id="S16T2U775">x</span>,<span class="var type1" id="S17T2U776">y</span>,<span class="mxinfo " id="T30:U601">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">        <span class="mxinfo " id="T28:U602"><span class="var type1" id="S35T28U780">max_vect</span> = <span class="mxinfo " id="T28:U604">[<span class="var type1" id="S26T2U783">max_h1</span>,<span class="var type1" id="S29T2U784">max_v1</span>,<span class="var type1" id="S31T2U785">max_dr</span>,<span class="var type1" id="S33T2U786">max_dl</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">        <span class="mxinfo " id="T28:U609"><span class="var type1" id="S36T28U789">k_vect</span> = <span class="mxinfo " id="T28:U611">[<span class="var type1" id="S27T2U792">k_h1</span>,<span class="var type1" id="S30T2U793">k_v1</span>,<span class="var type1" id="S32T2U794">k_dr</span>,<span class="var type1" id="S34T2U795">k_dl</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">        [<span class="mxinfo " id="T2:U616"><span class="var type1" id="S41T2U799">max_t2</span></span>, <span class="mxinfo " id="T2:U618"><span class="var type1" id="S42T2U800">index_t2</span></span>] = max(<span class="var type1" id="S35T28U803">max_vect</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">        <span class="mxinfo " id="T2:U621"><span class="var type1" id="S43T2U806">k_t2</span> = <span class="mxinfo " id="T2:U623"><span class="var type1" id="S36T28U808">k_vect</span>(<span class="var type1" id="S42T2U809">index_t2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T3:U626"><span class="var type1" id="S41T2U814">max_t2</span> &gt;= <span class="mxinfo " id="T2:U628"><span class="mxinfo " id="T2:U629"><span class="var type1" id="S4T2U816">t</span></span>*<span class="var type1" id="S37T2U817">max_t1</span></span></span> &amp;&amp; <span class="mxinfo " id="T3:U632"><span class="var type1" id="S43T2U819">k_t2</span> &gt; <span class="var type1" id="S39T2U820">k_t1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">                <span class="mxinfo " id="T2:U635"><span class="mxinfo " id="T2:U636"><span class="var type1" id="S15T1U824">S</span>(<span class="var type1" id="S16T2U825">x</span>,<span class="var type1" id="S17T2U826">y</span>)</span> = <span class="mxinfo " id="T2:U640"><span class="mxinfo " id="T2:U641">2</span>.^<span class="var type1" id="S43T2U829">k_t2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"><span class="comment">%% Step 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line"><span class="comment">% figure</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line"><span class="comment">% imshow(int8(S))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line"><span class="mxinfo " id="T2:U643"><span class="var type1" id="S2T2U832">Fcoarseness</span> = <span class="mxinfo " id="T2:U645"><span class="mxinfo " id="T2:U646">sum(<span class="mxinfo " id="T18:U647"><span class="var type1" id="S15T1U837">S</span>(:)</span>)</span>/(<span class="mxinfo " id="T2:U649"><span class="var type1" id="S6T2U841">height</span>*<span class="var type1" id="S7T2U842">width</span></span>)</span></span>;</span></span>
</pre>
